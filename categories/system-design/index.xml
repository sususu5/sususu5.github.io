<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>System Design on David Hua</title>
        <link>https://sususu5.github.io/categories/system-design/</link>
        <description>Recent content in System Design on David Hua</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>en</language>
        <copyright>David Hua</copyright>
        <lastBuildDate>Sat, 07 Jun 2025 11:43:38 +1000</lastBuildDate><atom:link href="https://sususu5.github.io/categories/system-design/index.xml" rel="self" type="application/rss+xml" /><item>
        <title>How to Design a POI (Point of Interest) Service</title>
        <link>https://sususu5.github.io/p/how-to-design-a-poi-point-of-interest-service/</link>
        <pubDate>Sat, 07 Jun 2025 11:43:38 +1000</pubDate>
        
        <guid>https://sususu5.github.io/p/how-to-design-a-poi-point-of-interest-service/</guid>
        <description>&lt;h1 id=&#34;how-to-design-a-poi-point-of-interest-service&#34;&gt;How to design a POI (Point of Interest) Service
&lt;/h1&gt;&lt;h2 id=&#34;functional-requirements&#34;&gt;Functional Requirements
&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;Searching nearby locations&lt;/li&gt;
&lt;li&gt;Viewing details&lt;/li&gt;
&lt;li&gt;Owners can edit / delete&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;non-functional-requirements&#34;&gt;Non-functional Requirements
&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;Latency: 1s&lt;/li&gt;
&lt;li&gt;Freshness: 1 day -&amp;gt; 1 hour&lt;/li&gt;
&lt;li&gt;Scalability&lt;/li&gt;
&lt;li&gt;Fault Tolerance&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;assumptions&#34;&gt;Assumptions
&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;1B users -&amp;gt; 50% -&amp;gt; 500M DAU&lt;/li&gt;
&lt;li&gt;200M businesses&lt;/li&gt;
&lt;li&gt;Storage: NoSQL, SQL, in memory&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;database-selection&#34;&gt;Database Selection
&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;In-memory: using multiple machines to shard the data, and the latency requirement is 1s, it&amp;rsquo;s expensive to use this&lt;/li&gt;
&lt;li&gt;SQL: more expensive&lt;/li&gt;
&lt;li&gt;NoSQL: cheaper, fast querying, self-sharding and optimization, suitable&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;how-to-scale-searching&#34;&gt;How to scale searching
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;Master-Slave Model, separate reading and writing&lt;/li&gt;
&lt;li&gt;This system is suitable for using this model because the need for reading is much more than writing&lt;/li&gt;
&lt;li&gt;Not using whole table scaning here, given longtitude and latitude&lt;/li&gt;
&lt;li&gt;Composite Index can not speed up the searching here because it follows the &lt;strong&gt;Leftmost Prefix Rule&lt;/strong&gt;, we can only search the range of the latitude once the longitude is matched, so it equals whole table scaning&lt;/li&gt;
&lt;li&gt;Two other effective searching ways will be introduced in the following content&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;geohash&#34;&gt;GeoHash
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;GeoHash is a spatial hashing algorithm that continuously divides latitude and longitude ranges in half (using a Z-order curve), converting a (latitude, longitude) pair into a Base32 string that represents the geographic grid cell in which the location falls&lt;/li&gt;
&lt;li&gt;It is a value stored in the database&lt;/li&gt;
&lt;li&gt;The longer the string, the higher the precision of the geographical location&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;quad-tree&#34;&gt;Quad Tree
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;A Quad Tree is a tree data structure that recursively partitions a two-dimensional space into four quadrants (subregions). Each node in the tree has up to four children representing the top-left, top-right, bottom-left, and bottom-right regions&lt;/li&gt;
&lt;li&gt;It is a memory structure&lt;/li&gt;
&lt;li&gt;Quad Tree can be used as indicies to speed up the searching (k values), assume each node contains about 100 businesses&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Can it fits into memory?
(business_id, latitude, longitute, short_brief) &amp;lt; 50B
(200M / 100) * (100 * 50B) = 10GB, which can be stored in memory, meets the latency requirement in 1 second&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;How to build this tree?
Need a starting point, stored on disk as a seed value&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;How to update this tree?
Live update / eventually consistecy&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Adding a cache to store the latitude, longitude, and their corresponding business list, extra cost.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Construct the Quad Tree according to the deployment (west, middle, east USA), extra cost, availability&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&#34;https://sususu5.github.io/images/sys_POI.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;System Architecture&#34;
	
	
&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>How to Design a TikTok</title>
        <link>https://sususu5.github.io/p/how-to-design-a-tiktok/</link>
        <pubDate>Tue, 03 Jun 2025 16:18:56 +1000</pubDate>
        
        <guid>https://sususu5.github.io/p/how-to-design-a-tiktok/</guid>
        <description>&lt;h1 id=&#34;how-to-design-a-tiktok&#34;&gt;How to design a TikTok
&lt;/h1&gt;&lt;h2 id=&#34;functional-requirements&#34;&gt;Functional Requirements
&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Video Upload&lt;/strong&gt;: Allow users to upload videos to the platform.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Video Playback&lt;/strong&gt;: Enable users to watch videos.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;By developing these, we can construct a minimum viable product.&lt;/p&gt;
&lt;h2 id=&#34;non-functional-requirements&#34;&gt;Non-functional Requirements
&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Scalability&lt;/strong&gt;: Support a massive user base with high concurrency.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Availability&lt;/strong&gt;: Ensure the system remains operational even during partial failures.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Low Latency&lt;/strong&gt;: Minimize delays in video loading and playback.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Fault Tolerance&lt;/strong&gt;: Handle hardware/network failures gracefully without data loss.&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;assumptions&#34;&gt;Assumptions
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;User Base&lt;/strong&gt;: 1 billion daily active users (DAU).&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Usage Patterns&lt;/strong&gt;:
&lt;ul&gt;
&lt;li&gt;Each user watches 100 videos per day.&lt;/li&gt;
&lt;li&gt;Each user uploads 1 video per day.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Video Size&lt;/strong&gt;: Average video size is 10MB.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;database-selection-sql-vs-nosql&#34;&gt;Database Selection: SQL vs NoSQL
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;SQL Databases&lt;/strong&gt;:
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;Pros&lt;/em&gt;: Strong consistency, relational data support.&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Cons&lt;/em&gt;: Challenges with sharding and hotspot management.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;NoSQL Databases&lt;/strong&gt;:
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;Pros&lt;/em&gt;: Cost-effective, horizontally scalable.&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Cons&lt;/em&gt;: Limited transactional support.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;video-storage-strategy&#34;&gt;Video Storage Strategy
&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;Blob Storage (Binary Large Object)&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Optimized for unstructured data (videos, images, audio).&lt;/li&gt;
&lt;li&gt;Ideal for storing and retrieving large volumes of small files efficiently.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;how-to-upload-a-video&#34;&gt;How to upload a video
&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;Since we don&amp;rsquo;t know what users are uploading, exposing the storage to the interface directly is unsafe.&lt;/li&gt;
&lt;li&gt;A better option is allocating a temporary space to store the original videos uploaded by users.&lt;/li&gt;
&lt;li&gt;When uploading, a video can be cut into small pieces to support &lt;strong&gt;breakpoint resume upload&lt;/strong&gt; when a break happens, and also parallel uploading, which means multiple segments can be uploaded simultaneously. (for a mobile app, the network environment is not stable)&lt;/li&gt;
&lt;li&gt;Once all segments are uploaded, we can use a message queue and a worker pool to merge all the segments and do a file integrity verification. After that, this video should be encoded into different formats because videos of different qualities should be played according to devices and network.&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;how-to-watch-a-video&#34;&gt;How to watch a video
&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;To avoid hotspots caused by frequent access to popular videos, we can deploy a CDN near user locations to offload traffic from the blob storage.&lt;/li&gt;
&lt;li&gt;Although storing videos in a CDN speeds up delivery and reduces latency, it also comes with high costs. So, we should make sure only the most popular videos are cached there.&lt;/li&gt;
&lt;li&gt;By introducing an extractor service, it can regularly find popular videos from the blob storage and send them to the CDN, those outdated videos are replaced.&lt;/li&gt;
&lt;li&gt;We can also introduce a streaming protocol like the HTTP Live Streaming from Apple to realize &amp;ldquo;stream-as-you-go&amp;rdquo; manner, which improves user experience.&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;show-off&#34;&gt;Show off
&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;We can introduce a recommendation system to recommend videos to users rather than pushing original feed accoring to the time.&lt;/li&gt;
&lt;li&gt;We can introduce a Two-Tower Model to embed user and video features into separate vectors. When a client requests videos, the system can recommend those that match their interests based on vector similarity.&lt;/li&gt;
&lt;li&gt;The pro is the vieo watching time of clients can be extended, the con is the extra cost of hiring a team to construct and deploy the model.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&#34;https://sususu5.github.io/images/sys_tiktok.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;System Architecture&#34;
	
	
&gt;&lt;/p&gt;
</description>
        </item>
        
    </channel>
</rss>
