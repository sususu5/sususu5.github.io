<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="Adapting HPX&rsquo;s Parallel Algorithms for Usage with Senders and Receivers What is partitioner_with_cleanup in HPX What are Senders and Receivers What is this project about Difficulties and challenges Completed works Future works Acknowledgments This report presents the final outcomes of my Google Summer of Code 2025 project with the Ste||ar Group and serves as complete documentation for anyone interested in the implementation details and results.\n">
<title>Google Summer of Code Final Report</title>

<link rel='canonical' href='https://sususu5.github.io/p/google-summer-of-code-final-report/'>

<link rel="stylesheet" href="/scss/style.min.01feed6d848e3950b9febe84494af2028b9cc1c147cd1d4a39ba458c53c18aeb.css"><meta property='og:title' content="Google Summer of Code Final Report">
<meta property='og:description' content="Adapting HPX&rsquo;s Parallel Algorithms for Usage with Senders and Receivers What is partitioner_with_cleanup in HPX What are Senders and Receivers What is this project about Difficulties and challenges Completed works Future works Acknowledgments This report presents the final outcomes of my Google Summer of Code 2025 project with the Ste||ar Group and serves as complete documentation for anyone interested in the implementation details and results.\n">
<meta property='og:url' content='https://sususu5.github.io/p/google-summer-of-code-final-report/'>
<meta property='og:site_name' content='David Hua'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2025-08-29T18:23:46&#43;10:00'/><meta property='article:modified_time' content='2025-08-29T18:23:46&#43;10:00'/>
<meta name="twitter:title" content="Google Summer of Code Final Report">
<meta name="twitter:description" content="Adapting HPX&rsquo;s Parallel Algorithms for Usage with Senders and Receivers What is partitioner_with_cleanup in HPX What are Senders and Receivers What is this project about Difficulties and challenges Completed works Future works Acknowledgments This report presents the final outcomes of my Google Summer of Code 2025 project with the Ste||ar Group and serves as complete documentation for anyone interested in the implementation details and results.\n">
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu_c169b61978309be5.png" width="300"
                            height="299" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ðŸ‘‹</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">David Hua</a></h1>
            <h2 class="site-description">Welcome to my blog</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/sususu5'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://www.linkedin.com/in/zhengnan-hua'
                        target="_blank"
                        title="LinkedIn"
                        rel="me"
                    >
                        
                        
                            <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-brand-linkedin"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M8 11v5" /><path d="M8 8v.01" /><path d="M12 16v-5" /><path d="M16 16v-3a2 2 0 1 0 -4 0" /><path d="M3 7a4 4 0 0 1 4 -4h10a4 4 0 0 1 4 4v10a4 4 0 0 1 -4 4h-10a4 4 0 0 1 -4 -4z" /></svg>
                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>Dark Mode</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#adapting-hpxs-parallel-algorithms-for-usage-with-senders-and-receivers">Adapting HPX&rsquo;s Parallel Algorithms for Usage with Senders and Receivers</a></li>
    <li><a href="#what-is-partitioner_with_cleanup-in-hpx">What is <code>partitioner_with_cleanup</code> in HPX</a></li>
    <li><a href="#what-are-senders-and-receivers">What are Senders and Receivers</a></li>
    <li><a href="#what-is-this-project-about">What is this project about</a></li>
    <li><a href="#difficulties-and-challenges">Difficulties and challenges</a></li>
    <li><a href="#completed-works">Completed works</a></li>
    <li><a href="#future-work">Future Work</a></li>
    <li><a href="#acknowledgments">Acknowledgments</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/google-summer-of-code/" style="background-color: #4285f4; color: #fff;">
                Google Summer of Code
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/google-summer-of-code-final-report/">Google Summer of Code Final Report</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Aug 29, 2025</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    8 minute read
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h2 id="adapting-hpxs-parallel-algorithms-for-usage-with-senders-and-receivers">Adapting HPX&rsquo;s Parallel Algorithms for Usage with Senders and Receivers
</h2><p><img src="/p/google-summer-of-code-final-report/image.png"
	width="1280"
	height="640"
	srcset="/p/google-summer-of-code-final-report/image_hu_fc3e2176e42c3946.png 480w, /p/google-summer-of-code-final-report/image_hu_fc0288407c370265.png 1024w"
	loading="lazy"
	
		alt="HPX logo"
	
	
		class="gallery-image" 
		data-flex-grow="200"
		data-flex-basis="480px"
	
></p>
<ol>
<li><a class="link" href="#what-is-partitioner_with_cleanup-in-hpx" >What is <code>partitioner_with_cleanup</code> in HPX</a></li>
<li><a class="link" href="#what-are-senders-and-receivers" >What are Senders and Receivers</a></li>
<li><a class="link" href="#what-is-this-project-about" >What is this project about</a></li>
<li><a class="link" href="#difficulties-and-challenges" >Difficulties and challenges</a></li>
<li><a class="link" href="#completed-works" >Completed works</a></li>
<li><a class="link" href="#future-works" >Future works</a></li>
<li><a class="link" href="#acknowledgments" >Acknowledgments</a></li>
</ol>
<hr>
<p>This report presents the final outcomes of my <a class="link" href="https://summerofcode.withgoogle.com/"  target="_blank" rel="noopener"
    >Google Summer of Code 2025</a> project with the <a class="link" href="https://stellar-group.org/"  target="_blank" rel="noopener"
    >Ste||ar Group</a> and serves as complete documentation for anyone interested in the implementation details and results.</p>
<p>HPX provides a comprehensive implementation of parallel algorithms that serves as both a standards-compliant C++ library and a high-performance computing runtime system. With the upcoming C++26 standard introducing the Senders/Receivers programming model for asynchronous execution, it becomes crucial to ensure HPX&rsquo;s compatibility with it.</p>
<p>However, parallel algorithms based on the <code>partitioner_with_cleanup</code> component currently don&rsquo;t have support for the Senders/Receivers model, this project aims to bridge the gap by adding modification to this component, adjusting these algorithms themselves and providing comprehensive unit tests.</p>
<h2 id="what-is-partitioner_with_cleanup-in-hpx">What is <code>partitioner_with_cleanup</code> in HPX
</h2><p>The <code>hpx::parallel::util::partitioner_with_cleanup</code> component in HPX library serves as the central execution engine for HPX&rsquo;s parallel algorithms, the functionality of it is mostly the same as <code>hpx::parallel::util::partitioner</code>, but introduces extra <strong>cleanup</strong> semantic. This critical infrastructure component handles the complex task of dividing work into parallel chunks, managing their execution across different policies, and ensuring robust error handling and resource cleanup.</p>
<p>To be specific, the running process of <code>partitioner_with_cleanup</code> can be divided into the following steps:</p>
<ol>
<li>Bind policy/executor parameters.</li>
<li>Build partition shape and bulk-launch chunk work (<code>f1</code>) on executor.</li>
<li>Reduce results (<code>f2</code>) while applying error handling.</li>
<li>On any failure, run cleanup on successful chunks to roll back.</li>
<li>Return result type dictated by policy</li>
</ol>
<p>Within the <code>partitioner_with_cleanup</code> component, HPX provides two distinct implementations to handle different execution models. The <code>static_partitioner_with_cleanup</code> is used for non-task execution policies, including sequenced/parallel policies and Sender/Receiver execution. In contrast, the <code>task_static_partitioner_with_cleanup</code> is used for task-based execution policies such as sequenced_task and parallel_task.</p>
<p>In the call chain, there are two main functions, which are the <code>call</code> function and <code>reduce</code> function, they are responsible for the partitioning and reducing process respectively.</p>
<p>The <code>call</code> function takes the following parameters: an execution policy <code>policy</code>, a range (a forward iterator <code>first</code> and a <code>std::size_t</code> value <code>count</code>), a per-chunk worker <code>f1</code>, a final reducer <code>f2</code>, and a cleanup function <code>cleanup</code>. This function firstly partitions the range into chunks according to the execution policy, calling <code>f1</code> on all chunks, then call the <code>reduce</code> function to merge the algorithm results.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">template &lt;typename ExPolicy_, typename FwdIter, typename F1,
</span></span><span class="line"><span class="cl">    typename F2, typename Cleanup&gt;
</span></span><span class="line"><span class="cl">static decltype(auto) call(ExPolicy_&amp;&amp; policy, FwdIter first,
</span></span><span class="line"><span class="cl">    std::size_t count, F1&amp;&amp; f1, F2&amp;&amp; f2, Cleanup&amp;&amp; cleanup)
</span></span></code></pre></td></tr></table>
</div>
</div><p>The <code>reduce</code> function takes three parameters: a list of chunk results <code>workitems</code>, a reducing function <code>f</code>, and a cleanup function <code>cleanup</code>, This function firstly waits for all workitems to complete. If there is any exception returned by workitems, the <code>cleanup</code> function will be called on all successful results and the captured exceptions are thrown again. If all the workitems are successful, a result of calling the reduce function will be returned.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">template &lt;typename Items, typename F, typename Cleanup&gt;
</span></span><span class="line"><span class="cl">static decltype(auto) reduce(Items&amp;&amp; workitems, F&amp;&amp; f, Cleanup&amp;&amp; cleanup)
</span></span></code></pre></td></tr></table>
</div>
</div><p>If you are interested in more details about HPX&rsquo;s parallel algorithms, a good reference is <a class="link" href="https://gsoc.wukovitsch.com/final-report-hpx-2024/"  target="_blank" rel="noopener"
    >Tobias Wukovitsch&rsquo;s project</a> of Google Summer of Code 2024, which includes a clear and detailed introduction.</p>
<h2 id="what-are-senders-and-receivers">What are Senders and Receivers
</h2><p>Since this project is about Senders/Receivers, it&rsquo;s important to provide a brief introduction to it.</p>
<p>Modern C++ has long lacked a standard way to express asynchronous operations. Existing approaches such as futures, callbacks, or third-party libraries often suffer from inconsistent semantics or limited support for cancellation and error handling, which may cause potential issues.</p>
<p>Hence, the C++ standards committee has been working on a proposal known as P2300: std::execution, which introduces a new abstraction for asynchronous programming called the Senders/Receivers model. This proposal is expected to form the foundation of future concurrency support in the C++ standard.</p>
<p>At its core, the Senders/Receivers model separates two roles: the Sender, which produces an asynchronous result, and the Receiver, which consumes it. A sender does not run work immediately but describes what will be done once execution starts.</p>
<p>To execute a sender, it should be firstly connected to a receiver through <code>connect()</code>, which forms an operation state, this object knows what to do and where the result should be given to. Then, <code>start()</code> must be called on it to trigger the actual asynchronous execution.</p>
<p>When the work completes, the sender signals the receiver in one of three ways:</p>
<ul>
<li>Value â†’ the operation completed successfully and produced a result</li>
<li>Error â†’ the operation failed and communicates the failure downstream</li>
<li>Stopped â†’ the operation was cancelled before producing a result</li>
</ul>
<p>This tri-state completion model makes error handling and cancellation first-class citizens rather than afterthoughts. It also allows asynchronous operations to be composed in a consistent and declarative style.</p>
<p>In the exact codebase, developers often uses functions like <code>sync_wait()</code>, <code>when_all()</code>, and <code>let_value()</code> to implicitly complete the <code>connect()</code> and <code>start()</code> operations. Here is a simple example:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdexec/execution.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Create a thread pool and get its scheduler
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">stdexec</span><span class="o">::</span><span class="n">static_thread_pool</span> <span class="n">pool</span><span class="p">{</span><span class="mi">2</span><span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="k">auto</span> <span class="n">scheduler</span> <span class="o">=</span> <span class="n">pool</span><span class="p">.</span><span class="n">get_scheduler</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">auto</span> <span class="n">s</span> <span class="o">=</span> <span class="n">stdexec</span><span class="o">::</span><span class="n">just</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>                           <span class="c1">// just() describes &#34;generate 42&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>           <span class="o">|</span> <span class="n">stdexec</span><span class="o">::</span><span class="n">continue_on</span><span class="p">(</span><span class="n">scheduler</span><span class="p">)</span>             <span class="c1">// continue_on() switches execution to the pool&#39;s scheduler
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>           <span class="o">|</span> <span class="n">stdexec</span><span class="o">::</span><span class="n">then</span><span class="p">([](</span><span class="kt">int</span> <span class="n">x</span><span class="p">){</span> <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span> <span class="p">});</span>  <span class="c1">// then() describes &#34;times x by 2&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1">// sync_wait() explicitly connects a receiver and starts it
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">auto</span> <span class="p">[</span><span class="n">result</span><span class="p">]</span> <span class="o">=</span> <span class="n">stdexec</span><span class="o">::</span><span class="n">sync_wait</span><span class="p">(</span><span class="n">s</span><span class="p">).</span><span class="n">value</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Result = &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">result</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>          <span class="c1">// prints: 84
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="what-is-this-project-about">What is this project about
</h2><p>The primary goal of this project is to extend HPXâ€™s parallel algorithms so that they fully support the <strong>Senders/Receivers (S/R)</strong> model when built on top of the <code>partitioner_with_cleanup</code> component. The work is organized into three parts:</p>
<ol>
<li>
<p><strong>Extending <code>partitioner_with_cleanup</code></strong><br>
Introduce logic branches to handle calls originating from S/R-based execution, covering both launch policies and execution policies. These adaptations ensure clean integration with the S/R model while preserving existing semantics.</p>
</li>
<li>
<p><strong>Adapting algorithm implementations</strong><br>
Modify affected algorithms to align with S/R usage. To be specific, changing the return type from <code>algorithm_result</code> to <code>decltype(auto)</code> so that senders are correctly deduced as return values. Additionally, disable early exits in the S/R branch to keep sender chains intact and faithfully represent the asynchronous workflow.</p>
</li>
<li>
<p><strong>Developing unit tests</strong><br>
Provide a comprehensive suite of tests for the affected algorithms. Each test evaluates four combinations of launch and execution policies:</p>
<ul>
<li><code>hpx::launch::sync</code> with <code>seq(task)</code></li>
<li><code>hpx::launch::sync</code> with <code>unseq(task)</code></li>
<li><code>hpx::launch::async</code> with <code>seq(task)</code></li>
<li><code>hpx::launch::async</code> with <code>unseq(task)</code></li>
</ul>
<p>These combinations cover major usage scenarios and mirror test patterns used elsewhere in HPX, ensuring consistency and reliability.</p>
</li>
</ol>
<h2 id="difficulties-and-challenges">Difficulties and challenges
</h2><p>The key challenge of this project is how to modify the <code>partitioner_with_cleanup</code> component so that it can handle failures gracefully. While the regular <code>partitioner</code> component can assume everything will work perfectly and simply return the reduced results, <code>partitioner_with_cleanup</code> must be more cautious. It needs to track which subtasks succeed or fail, and more importantly, it must call <code>cleanup</code> functions for successful work when other parts of the operation fail.</p>
<p>As mentioned above, an asynchronous operation executed in the Senders/Receivers model can finish in three distinct ways, which are Value, Error, and Stopped. Therefore, if any chunk fails, the partitioning function <code>call</code> completes on the error channel. Consequently, the reduce function can only observe an error signal rather than all the chunk results from the algorithm, making it impossible to identify which chunks completed successfully and preventing proper <code>cleanup</code> function from being called.</p>
<p>Therefore, we need to distinguish between normal results and errors during execution. To achieve this, the <code>call</code> function wraps the original algorithm parameter <code>f1</code> in a lambda expression, ensuring that every return value is stored in a variant type. Each partition task therefore produces either a normal <code>Result</code> or an <code>exception_ptr</code>.</p>
<p>Next, the <code>reduce</code> function linearly traverses all partition results. If it detects an error, it first releases the resources held by already successful subtasks, and then rethrows the exception.</p>
<p>This pseudocode illustrates the principle, actual implementation differs in template details.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="o">//</span> <span class="n">Here</span> <span class="n">is</span> <span class="n">a</span> <span class="n">simplified</span> <span class="n">version</span> <span class="n">of</span> <span class="n">the</span> <span class="n">above</span> <span class="n">idea</span>
</span></span><span class="line"><span class="cl"><span class="o">//</span> <span class="mf">1.</span> <span class="n">Wrap</span> <span class="n">f1</span> <span class="n">so</span> <span class="n">each</span> <span class="n">chunk</span> <span class="n">returns</span> <span class="n">either</span> <span class="n">Result</span> <span class="ow">or</span> <span class="n">exception_ptr</span>
</span></span><span class="line"><span class="cl"><span class="n">auto</span> <span class="n">wrapped_f1</span> <span class="o">=</span> <span class="p">[</span><span class="o">&amp;</span><span class="p">](</span><span class="n">auto</span><span class="o">&amp;&amp;...</span> <span class="n">args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">std</span><span class="p">::</span><span class="n">variant</span><span class="o">&lt;</span><span class="n">Result</span><span class="p">,</span> <span class="n">std</span><span class="p">::</span><span class="n">exception_ptr</span><span class="o">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">f1</span><span class="p">(</span><span class="n">std</span><span class="p">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">decltype</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="o">&gt;</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="o">...</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="o">...</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">std</span><span class="p">::</span><span class="n">current_exception</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">//</span> <span class="mf">2.</span> <span class="n">Partition</span> <span class="n">returns</span> <span class="n">a</span> <span class="n">collection</span> <span class="n">of</span> <span class="n">variant</span> <span class="n">results</span>
</span></span><span class="line"><span class="cl"><span class="n">auto</span> <span class="n">items</span> <span class="o">=</span> <span class="n">partition</span><span class="o">&lt;</span><span class="n">std</span><span class="p">::</span><span class="n">variant</span><span class="o">&lt;</span><span class="n">Result</span><span class="p">,</span> <span class="n">std</span><span class="p">::</span><span class="n">exception_ptr</span><span class="o">&gt;&gt;</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                 <span class="n">policy</span><span class="p">,</span> <span class="n">first</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">wrapped_f1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">//</span> <span class="mf">3.</span> <span class="n">Reduce</span> <span class="n">traverses</span> <span class="n">all</span> <span class="n">items</span><span class="p">,</span> <span class="n">cleans</span> <span class="n">up</span> <span class="n">successes</span><span class="p">,</span> <span class="n">rethrows</span> <span class="n">on</span> <span class="n">error</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="n">auto</span><span class="o">&amp;</span> <span class="n">item</span> <span class="p">:</span> <span class="n">items</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">std</span><span class="p">::</span><span class="n">holds_alternative</span><span class="o">&lt;</span><span class="n">std</span><span class="p">::</span><span class="n">exception_ptr</span><span class="o">&gt;</span><span class="p">(</span><span class="n">item</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">cleanup_successful</span><span class="p">(</span><span class="n">items</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="p">::</span><span class="n">rethrow_exception</span><span class="p">(</span><span class="n">std</span><span class="p">::</span><span class="n">get</span><span class="o">&lt;</span><span class="n">std</span><span class="p">::</span><span class="n">exception_ptr</span><span class="o">&gt;</span><span class="p">(</span><span class="n">item</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In this way, although each subtask passes its result by value, the final Sender always completes in a successful state by returning a container of variants. The caller can then inspect this container to uniformly detect errors, perform cleanup, and rethrow exceptions if necessary.</p>
<h2 id="completed-works">Completed works
</h2><p>This project successfully integrated Senders/Receivers model support into all parallel algorithms that utilize the <code>partitioner_with_cleanup</code> component, accompanied by comprehensive unit test coverage.</p>
<p><strong>Memory Construction Algorithms:</strong></p>
<ul>
<li><code>uninitialized_copy</code>, <code>uninitialized_copy_n</code></li>
<li><code>uninitialized_default_construct</code>, <code>uninitialized_default_construct_n</code></li>
<li><code>uninitialized_fill</code>, <code>uninitialized_fill_n</code></li>
<li><code>uninitialized_value_construct</code>, <code>uninitialized_value_construct_n</code></li>
</ul>
<p><strong>Memory Movement Algorithms:</strong></p>
<ul>
<li><code>uninitialized_move</code>, <code>uninitialized_move_n</code></li>
<li><code>uninitialized_relocate</code>, <code>uninitialized_relocate_backward</code>, <code>uninitialized_relocate_n</code></li>
</ul>
<p>All implementation details, code modifications, and test cases can be reviewed in <a class="link" href="https://github.com/STEllAR-GROUP/hpx/pull/6741"  target="_blank" rel="noopener"
    >PR #6741</a>, which contains the complete set of changes of project.</p>
<h2 id="future-work">Future Work
</h2><p>While this project has successfully extended Senders/Receivers model support to more of HPX&rsquo;s parallel algorithms, several algorithms remain unadapted. Remaining work items are tracked in <a class="link" href="https://docs.google.com/spreadsheets/d/1zbz88UZn912nLiBMbRaMTQTU2lT0vZRigui4jrcbIRA/edit?gid=0#gid=0"  target="_blank" rel="noopener"
    >this table</a>.</p>
<p>In the future, development priority should include adapting all parallel algorithms to the Senders/Receivers model, optimizing the performance of these algorithms by fine-tuning the implementation and enhancing test cases.</p>
<h2 id="acknowledgments">Acknowledgments
</h2><p>I would like to express my sincere gratitude to <a class="link" href="https://github.com/hkaiser"  target="_blank" rel="noopener"
    >Hartmut Kaiser</a>, <a class="link" href="https://github.com/isidorostsa"  target="_blank" rel="noopener"
    >Isidoros Tsaousis-Seiras</a> and <a class="link" href="https://github.com/Pansysk75"  target="_blank" rel="noopener"
    >Panos Syskakis</a> for their invaluable guidance and continuous support throughout this project. Their expertise was instrumental in helping me navigate complex technical challenges.</p>
<p>I&rsquo;m also grateful to Tobias Wukovitsch for his excellent work and report in Google Summer of Code 2024, which provided essential background for this work.</p>
<p>Finally, I thank Google and the Google Summer of Code program for providing this incredible opportunity to contribute to open-source software and grow as a developer.</p>

</section>


    <footer class="article-footer">
    

    </footer>


    
</article>

    

    

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2025 David Hua
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.30.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
